{"version":3,"sources":["spark-scroll.coffee"],"names":[],"mappings":"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","file":"spark-scroll.js","sourceRoot":"/source/","sourcesContent":["angular.module('gilbox.sparkScroll', [])\n.constant 'sparkActionProps', {\n\n  # When the up, down fns are called, `this` is the current keyFrame object and `o` is the action object\n  # therefore @element and @scope refer to the current element and it's scope\n\n  # fn reference that is called when scrolled down past keyframe\n  'onDown':\n    down: (o)-> o.val(@, 'onDown', o)\n\n  # fn reference that is called when scrolled up past keyframe\n  'onUp':\n    up: (o)-> o.val(@, 'onUp', o)\n\n  # class(es) added when scrolled down past keyframe,\n  'downAddClass':\n    down: (o)-> @element.addClass(o.val)\n\n  # class(es) added when scrolled up past keyframe,\n  'upAddClass':\n    up: (o)-> @element.addClass(o.val)\n\n  # class(es) removed when scrolled down past keyframe\n  'downRemoveClass':\n    down: (o)-> @element.removeClass(o.val)\n\n  # class(es) removed when scrolled up past keyframe\n  'upRemoveClass':\n    up: (o)-> @element.removeClass(o.val)\n\n  # broadcasts an event when scrolled down past keyframe\n  'downBroadcast':\n    down: (o)-> @scope.$broadcast(o.val, @)\n\n  # broadcasts an event when scrolled up past keyframe\n  'upBroadcast':\n    up: (o)-> @scope.$broadcast(o.val, @)\n\n  # emits an event when scrolled down past keyframe\n  'downEmit':\n    down: (o)-> @scope.$emit(o.val, @)\n\n  # emits an event when scrolled up past keyframe\n  'upEmit':\n    up: (o)-> @scope.$emit(o.val, @)\n}\n\n.directive 'sparkScroll', ($window, sparkActionProps) ->\n  (scope, element, attr) ->\n    prevScrollY = 0\n    scrollY = 0\n\n    sparkData = {}\n    actionFrames = []\n    actionFrameIdx = -1\n\n    actionsUpdate = ->\n\n      d = scrollY - prevScrollY\n\n      if d<0 and actionFrameIdx >= 0  # scroll up: don't apply on page load (only apply on page load for downward movement)\n        idx = if (actionFrameIdx >= actionFrames.length) then actionFrameIdx-1 else actionFrameIdx\n        while (idx >= 0 and scrollY < actionFrames[idx])\n          c = sparkData[actionFrames[idx]]\n\n          for a, o of c.actions\n            for prop in o.props\n              actionProp = sparkActionProps[prop]\n              actionProp.up.call(c, o) if actionProp.up\n\n          actionFrameIdx = --idx\n\n      if d>=0 and actionFrameIdx < actionFrames.length  # scroll down: will apply on page load\n        idx = if (actionFrameIdx < 0) then 0 else actionFrameIdx\n        while (idx < actionFrames.length and scrollY > actionFrames[idx])\n          c = sparkData[actionFrames[idx]]\n\n          for a, o of c.actions\n            for prop in o.props\n              actionProp = sparkActionProps[prop]\n              actionProp.down.call(c, o) if actionProp.down\n\n          actionFrameIdx = ++idx\n\n      prevScrollY = scrollY\n\n\n    actionsUpdate = _.debounce(actionsUpdate, 66, {leading: true, maxWait: 66})\n\n\n    watchCancel = scope.$watch attr.sparkScroll, (data) ->\n      return unless data\n\n      # useful in angular < v1.3 where one-time binding isn't available\n      if attr.sparkScrollBindOnce? then watchCancel()\n\n      sparkData = data\n      actionFrames = []\n\n      for scrollY, keyFrame of sparkData\n\n#        actionCount = 0\n#        grossActionCount = 0\n\n        # put actions in actions sub-object\n        for k,v of keyFrame\n          ksplit = k.split(',')\n          if sparkActionProps[ksplit[0]] # @todo: rigorous check ? (we assume that if the first action is legit then they all are)\n            keyFrame.actions or= { }  # could be more efficient to make actions an array\n            keyFrame.actions[k] = # action object\n              props: ksplit\n              val: v\n            delete keyFrame[k]\n#           actionCount++\n#           grossActionCount += ksplit.length\n\n        keyFrame.element = element\n        keyFrame.scope = scope\n#        keyFrame.actionCount = actionCount\n#        keyFrame.grossActionCount = grossActionCount\n\n      actionFrames.push(parseInt(scrollY)) for scrollY of sparkData\n      actionFrames.sort (a,b) -> a > b\n\n      prevScrollY = scrollY = $window.scrollY\n      actionsUpdate()\n\n    , true  # deep watch\n\n    # respond to scroll event\n    angular.element($window).on 'scroll', ->\n      scrollY = $window.scrollY\n      actionsUpdate()\n\n    scope.$on '$destroy', ->\n      angular.element($window).off 'scroll'"]}
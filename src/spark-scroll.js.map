{"version":3,"sources":["spark-scroll.coffee"],"names":[],"mappings":"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","file":"spark-scroll.js","sourceRoot":"/source/","sourcesContent":["if (typeof define == 'function' && define.amd)\n  # When using rekapi with requirejs, you must handle the dependencies yourself, because\n  # here we assume that if require is being used then rekapi has already been loaded in\n  Rekapi = window.Rekapi or (require.defined('rekapi') and require('rekapi'))\n\n  # If any other deps are being loaded in without being exposed in the global namespace,\n  # the same as above applies\n  _ = window._ or (if require.defined('lodash') then require('lodash') else require('underscore'))\n  AnimationFrame = window.AnimationFrame or (if require.defined('animationFrame') then require('animationFrame') else require('AnimationFrame'))\nelse\n  [Rekapi, _, AnimationFrame] = [window.Rekapi, window._, window.AnimationFrame]\n\n\n\n\nangular.module('gilbox.sparkScroll', [])\n\n# sparkAnimator can be overridden to use any animation engine\n# so long as the sparkAnimator service supports the following Rekapi-like\n# interface:\n#\n# actor = sparkAnimator.addActor({ context: <dom element> })  # works just like Rekapi.addActor(...)\n# actor.keyframe(...)\n# actor.moveKeyframe(...)\n# actor.removeAllKeyframes(...)\n# sparkAnimator.update(...)       # works just like Rekapi.update(...)\n#\n# See the Rekapi docs for implementation details   http://rekapi.com/dist/doc/\n.factory 'sparkAnimator', ($document) ->\n  instance: ->\n    Rekapi && new Rekapi($document[0].body)\n\n.constant 'sparkFormulas', {\n\n  # formulas are always in the format: variable or variable<offset>\n  #   (note that you cannot combine formula variables)\n  # for example:\n  #\n  #      top+40\n  #      top-120\n  #      top\n  #      center\n  #      center-111\n  #\n  # are valid formulas. (top40 is valid as well but less intuitive)\n  #\n  # each property of the sparkFormulas object is a formula variable\n\n  # top of the element hits the top of the viewport\n  top: (element, container, rect, containerRect, offset) ->  ~~(rect.top - containerRect.top + offset)\n\n  # top of the element hits the center of the viewport\n  center: (element, container, rect, containerRect, offset) ->  ~~(rect.top - containerRect.top - container.clientHeight/2 + offset)\n\n  # top of the element hits the bottom of the viewport\n  bottom: (element, container, rect, containerRect, offset) ->  ~~(rect.top - containerRect.top - container.clientHeight + offset)\n}\n\n.constant 'sparkActionProps', {\n\n  # When the up, down fns are called, `this` is the current keyFrame object and `o` is the action object\n  # therefore @element and @scope refer to the current element and it's scope\n\n  # fn reference that is called when scrolled down past keyframe\n  'onDown':\n    down: (o)-> o.val(@, 'onDown', o)\n\n  # fn reference that is called when scrolled up past keyframe\n  'onUp':\n    up: (o)-> o.val(@, 'onUp', o)\n\n  # class(es) added when scrolled down past keyframe,\n  'downAddClass':\n    down: (o)-> @element.addClass(o.val)\n\n  # class(es) added when scrolled up past keyframe,\n  'upAddClass':\n    up: (o)-> @element.addClass(o.val)\n\n  # class(es) removed when scrolled down past keyframe\n  'downRemoveClass':\n    down: (o)-> @element.removeClass(o.val)\n\n  # class(es) removed when scrolled up past keyframe\n  'upRemoveClass':\n    up: (o)-> @element.removeClass(o.val)\n\n  # broadcasts an event when scrolled down past keyframe\n  'downBroadcast':\n    down: (o)-> @scope.$broadcast(o.val, @)\n\n  # broadcasts an event when scrolled up past keyframe\n  'upBroadcast':\n    up: (o)-> @scope.$broadcast(o.val, @)\n\n  # emits an event when scrolled down past keyframe\n  'downEmit':\n    down: (o)-> @scope.$emit(o.val, @)\n\n  # emits an event when scrolled up past keyframe\n  'upEmit':\n    up: (o)-> @scope.$emit(o.val, @)\n}\n\n.service 'sparkSetup', ($interval, $rootScope) ->\n  int = 0\n  @enableInvalidationInterval = (delay = 1000) ->\n    $interval.cancel(int) if int\n    int = $interval (-> $rootScope.$broadcast 'sparkInvalidate'), delay, 0, false\n\n  @disableInvalidationInterval = -> $interval.cancel(int)\n  @\n\n.service 'sparkId', ->\n  @elements = {}\n  @registerElement = (id, element) ->\n    @elements[id] = element\n  @\n\n.directive 'sparkId', (sparkId)->\n  (scope, element, attr) ->\n    sparkId.registerElement(attr.sparkId, element)\n    scope.$on '$destroy', -> delete sparkId.elements[attr.sparkId]\n\ndirectiveFn = ($window, $timeout, sparkFormulas, sparkActionProps, sparkAnimator, sparkId) ->\n  (scope, element, attr) ->\n\n    hasAnimateAttr = attr.hasOwnProperty('sparkScrollAnimate')  # when using spark-scroll-animate directive animation is enabled\n    isAnimated = hasAnimateAttr\n\n    animator = hasAnimateAttr && sparkAnimator.instance()\n    actor = isAnimated && animator.addActor({ context: element[0] })\n    y = 0\n    prevy = 0\n    scrollY = 0\n    animationFrame = AnimationFrame && new AnimationFrame()\n    updating = false\n\n    sparkData = {}\n    actionFrames = []\n    actionFrameIdx = -1\n    container = document.documentElement\n\n    triggerElement = element\n\n    if attr.sparkTrigger\n      setTriggerElement = ->\n        if sparkId.elements[attr.sparkTrigger]\n          triggerElement = sparkId.elements[attr.sparkTrigger]\n          recalcFormulas() if recalcFormulas\n        else\n          # aggressively poll for the trigger element if we don't find it (because it's not ready yet)\n          $timeout setTriggerElement, 0, false\n      setTriggerElement()\n\n    actionsUpdate = ->\n\n      d = y - prevy\n\n      if d<0 and actionFrameIdx >= 0  # scroll up: don't apply on page load (only apply on page load for downward movement)\n        idx = if (actionFrameIdx >= actionFrames.length) then actionFrameIdx-1 else actionFrameIdx\n        while (idx >= 0 and y < actionFrames[idx])\n          c = sparkData[actionFrames[idx]]\n\n          for a, o of c.actions\n            for prop in o.props\n              actionProp = sparkActionProps[prop]\n              actionProp.up.call(c, o) if actionProp.up\n\n          actionFrameIdx = --idx\n\n      if d>=0 and actionFrameIdx < actionFrames.length  # scroll down: will apply on page load\n        idx = if (actionFrameIdx < 0) then 0 else actionFrameIdx\n        while (idx < actionFrames.length and y > actionFrames[idx])\n          c = sparkData[actionFrames[idx]]\n\n          for a, o of c.actions\n            for prop in o.props\n              actionProp = sparkActionProps[prop]\n              actionProp.down.call(c, o) if actionProp.down\n\n          actionFrameIdx = ++idx\n\n      prevy = y\n\n\n    # update for spark-scroll-animate (sparkAnimator-based) animation\n    if attr.hasOwnProperty('sparkScrollEase')\n      update = ->\n        d = scrollY - y\n        ad = Math.abs(d)\n        if ad < 1.5\n          updating = false\n          y = scrollY\n          animator.update(y)\n        else\n          updating = true\n          y += if ad>8 then d*0.25 else (if d > 0 then 1 else -1) # ease the scroll\n          animator.update(parseInt(y))\n          animationFrame.request(update)\n        actionsUpdate()\n    else\n      update = ->\n        updating = false\n        y = scrollY\n        animator.update(y)\n        actionsUpdate()\n\n\n    recalcFormulas = ->\n      changed = false\n      rect = triggerElement[0].getBoundingClientRect()\n      containerRect = container.getBoundingClientRect()\n\n      for scrY, keyFrame of sparkData when keyFrame.formula\n        newScrY = keyFrame.formula.fn(triggerElement, container, rect, containerRect, keyFrame.formula.offset)\n        if newScrY != ~~scrY\n          changed = true\n          actor.moveKeyframe(~~scrY, newScrY) if keyFrame.anims and hasAnimateAttr # the ~~ is necessary :(\n          sparkData[newScrY] = keyFrame\n          delete sparkData[scrY]\n\n      if changed\n        actionFrames = []\n        actionFrames.push(~~scrY) for scrY of sparkData\n        actionFrames.sort (a,b) -> a > b\n        onScroll()  # todo: this is checking scrollY unnecessarily\n        # @todo: now are we screwed if something was already passed by ?\n\n\n    watchCancel = scope.$watch attr[if hasAnimateAttr then 'sparkScrollAnimate' else 'sparkScroll'], (data) ->\n      return unless data\n\n      # useful in angular < v1.3 where one-time binding isn't available\n      if attr.sparkScrollBindOnce? then watchCancel()\n\n      actor.removeAllKeyframes() if hasAnimateAttr\n\n      # element ease property\n      elmEase = data.ease || 'linear';\n      delete data.ease\n      animCount = 0\n\n      sparkData = {}\n      actionFrames = []\n\n      # this is used for formula comprehension... a possible performance improvement might\n      # forgo these calculations by adding some option or deferring calculation automatically\n      rect = triggerElement[0].getBoundingClientRect()\n      containerRect = container.getBoundingClientRect()\n\n      for scrY, keyFrame of data\n        actionCount = 0\n\n        # formula comprehension\n        # when scrollY first char is not a digit, we assume this is a formula\n        c = scrY.charCodeAt(0)\n        if (c < 48 or c > 57)\n          parts = scrY.match(/^(\\w+)(.*)$/)\n          formula =\n            fn: sparkFormulas[parts[1]],\n            offset: ~~parts[2]\n\n          scrY = formula.fn(triggerElement, container, rect, containerRect, formula.offset)\n          return if sparkData[scrY]  # silent death for overlapping scrY's (assume that the element isn't ready)\n\n        # keyframe ease property\n        # (will override or fallback to element ease property)\n        ease = {}\n        kfEase = elmEase\n        if keyFrame.ease?\n          if angular.isObject(keyFrame.ease)\n            ease = keyFrame.ease\n          else\n            kfEase = keyFrame.ease\n          delete keyFrame.ease\n\n        for k,v of keyFrame\n            ksplit = k.split(',')\n\n            # put actions in actions sub-object\n            if sparkActionProps[ksplit[0]] # @todo: rigorous check ? (we assume that if the first action is legit then they all are)\n\n              keyFrame.actions or= { }  # could be more efficient to make actions an array\n              keyFrame.actions[k] = # action object\n                props: ksplit\n                val: v\n              delete keyFrame[k]\n              actionCount++\n\n            # put animations in anims sub-object\n            else # since it's not an action, assume it's an animation property\n\n              # comprehension of array-notation for easing\n              # (will override or fall back to keyframe ease propery as needed)\n              keyFrame.anims or= {}\n              v = [v, kfEase] unless angular.isArray(v)\n              o = {}\n              o[k] = v[1]\n              angular.extend(ease, o)\n\n              keyFrame.anims[k] = v[0]\n              delete keyFrame[k]\n\n        if keyFrame.anims && hasAnimateAttr\n          actor.keyframe(scrY, keyFrame.anims, ease)\n          animCount++\n\n        keyFrame.formula = formula\n        keyFrame.element = element\n        keyFrame.scope = scope\n  #        keyFrame.actionCount = actionCount\n\n        sparkData[scrY] = keyFrame\n        actionFrames.push(~~scrY) if actionCount\n\n      isAnimated = hasAnimateAttr && !! animCount\n\n      actionFrames.sort (a,b) -> a > b\n\n      y = prevy = scrollY = $window.scrollY\n      update() if isAnimated\n      actionsUpdate()\n\n    , true  # deep watch\n\n    # respond to scroll event\n\n    onScroll = ->\n      scrollY = $window.scrollY\n\n      if isAnimated\n        unless updating # debounced update\n          updating = true # in-case multiple scroll events can occur in one frame (possible?)\n          animationFrame.request(update)\n      else\n        y = scrollY\n        animationFrame.request(actionsUpdate) # @todo: do these calls get queued between frames ?\n\n    onInvalidate = _.debounce(recalcFormulas, 100, {leading: false})\n\n    angular.element($window).on 'scroll', onScroll\n    angular.element($window).on 'resize', onInvalidate\n    scope.$on 'sparkInvalidate', onInvalidate\n\n    scope.$on '$destroy', ->\n      animator.removeActor(actor) if isAnimated\n      angular.element($window).off 'scroll', onScroll\n      angular.element($window).off 'resize', onInvalidate\n\n\nangular.module('gilbox.sparkScroll')\n  .directive 'sparkScroll',        ['$window', '$timeout', 'sparkFormulas', 'sparkActionProps', 'sparkAnimator', 'sparkId', directiveFn]\n  .directive 'sparkScrollAnimate', ['$window', '$timeout', 'sparkFormulas', 'sparkActionProps', 'sparkAnimator', 'sparkId', directiveFn]\n"]}
{"version":3,"sources":["spark-scroll.coffee"],"names":[],"mappings":"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","file":"spark-scroll.js","sourceRoot":"/source/","sourcesContent":["if (typeof define == 'function' && define.amd)\n  # When using rekapi with requirejs, you must handle the dependencies yourself, because\n  # here we assume that if require is being used then rekapi has already been loaded in\n  Rekapi = window.Rekapi or (require.defined('rekapi') and require('rekapi'))\n\n  # If any other deps are being loaded in without being exposed in the global namespace,\n  # the same as above applies\n  _ = window._ or (if require.defined('lodash') then require('lodash') else require('underscore'))\n  AnimationFrame = window.AnimationFrame or (if require.defined('animationFrame') then require('animationFrame') else require('AnimationFrame'))\nelse\n  [Rekapi, _, AnimationFrame] = [window.Rekapi, window._, window.AnimationFrame]\n\n\n\n\nangular.module('gilbox.sparkScroll', [])\n\n# sparkAnimator can be overridden to use any animation engine\n# so long as the sparkAnimator service supports the following Rekapi-like\n# interface:\n#\n# actor = sparkAnimator.addActor({ context: <dom element> })  # works just like Rekapi.addActor(...)\n# actor.keyframe(...)\n# actor.moveKeyframe(...)\n# actor.removeAllKeyframes(...)\n# sparkAnimator.update(...)       # works just like Rekapi.update(...)\n#\n# See the Rekapi docs for implementation details   http://rekapi.com/dist/doc/\n.factory 'sparkAnimator', ($document) ->\n  instance: ->\n    Rekapi && new Rekapi($document[0].body)\n\n.constant 'sparkFormulas', {\n\n  # formulas are always in the format: variable or variable<offset>\n  #   (note that you cannot combine formula variables)\n  # for example:\n  #\n  #      top+40\n  #      top-120\n  #      top\n  #      center\n  #      center-111\n  #\n  # are valid formulas. (top40 is valid as well but less intuitive)\n  #\n  # each property of the sparkFormulas object is a formula variable\n\n  # top of the element hits the top of the viewport\n  topTop: `function topTop(element, container, rect, containerRect, offset) { return ~~(rect.top - containerRect.top + offset) }`\n\n  # top of the element hits the center of the viewport\n  topCenter: `function topCenter(element, container, rect, containerRect, offset) { return ~~(rect.top - containerRect.top - container.clientHeight/2 + offset) }`\n\n  # top of the element hits the bottom of the viewport\n  topBottom: `function topBottom(element, container, rect, containerRect, offset) {  return ~~(rect.top - containerRect.top - container.clientHeight + offset) }`\n\n  # center of the element hits the top of the viewport\n  centerTop: `function centerTop(element, container, rect, containerRect, offset) { return ~~(rect.top + rect.height/2 - containerRect.top + offset) }`\n\n  # center of the element hits the center of the viewport\n  centerCenter: `function centerCenter(element, container, rect, containerRect, offset) { return ~~(rect.top + rect.height/2 - containerRect.top - container.clientHeight/2 + offset) }`\n\n  # center of the element hits the bottom of the viewport\n  centerBottom: `function centerBottom(element, container, rect, containerRect, offset) {  return ~~(rect.top + rect.height/2 - containerRect.top - container.clientHeight + offset) }`\n\n  # bottom of the element hits the top of the viewport\n  bottomTop: `function bottomTop(element, container, rect, containerRect, offset) { return ~~(rect.bottom - containerRect.top + offset) }`\n\n  # bottom of the element hits the bottom of the viewport\n  bottomBottom: `function bottomBottom(element, container, rect, containerRect, offset) { return ~~(rect.bottom - containerRect.top - container.clientHeight + offset) }`\n\n  # bottom of the element hits the center of the viewport\n  bottomCenter: `function bottomCenter(element, container, rect, containerRect, offset) { return ~~(rect.bottom - containerRect.top - container.clientHeight/2 + offset) }`\n}\n\n.constant 'sparkActionProps', {\n\n  # When the up, down fns are called, `this` is the current keyFrame object and `o` is the action object\n  # therefore @element and @scope refer to the current element and it's scope\n\n  # fn reference that is called when scrolled down past keyframe\n  'onDown':\n    down: (o)-> o.val(@, 'onDown', o)\n\n  # fn reference that is called when scrolled up past keyframe\n  'onUp':\n    up: (o)-> o.val(@, 'onUp', o)\n\n  # class(es) added when scrolled down past keyframe,\n  'downAddClass':\n    down: (o)-> @element.addClass(o.val)\n\n  # class(es) added when scrolled up past keyframe,\n  'upAddClass':\n    up: (o)-> @element.addClass(o.val)\n\n  # class(es) removed when scrolled down past keyframe\n  'downRemoveClass':\n    down: (o)-> @element.removeClass(o.val)\n\n  # class(es) removed when scrolled up past keyframe\n  'upRemoveClass':\n    up: (o)-> @element.removeClass(o.val)\n\n  # broadcasts an event when scrolled down past keyframe\n  'downBroadcast':\n    down: (o)-> @scope.$broadcast(o.val, @)\n\n  # broadcasts an event when scrolled up past keyframe\n  'upBroadcast':\n    up: (o)-> @scope.$broadcast(o.val, @)\n\n  # emits an event when scrolled down past keyframe\n  'downEmit':\n    down: (o)-> @scope.$emit(o.val, @)\n\n  # emits an event when scrolled up past keyframe\n  'upEmit':\n    up: (o)-> @scope.$emit(o.val, @)\n}\n\n.service 'sparkSetup', ($interval, $rootScope) ->\n  int = 0\n  @enableInvalidationInterval = (delay = 1000) ->\n    $interval.cancel(int) if int\n    int = $interval (-> $rootScope.$broadcast 'sparkInvalidate'), delay, 0, false\n\n  @disableInvalidationInterval = -> $interval.cancel(int)\n\n  # enable/disable logging\n  @debug = false\n  @\n\n.service 'sparkId', ->\n  @elements = {}\n  @registerElement = (id, element) ->\n    @elements[id] = element\n  @\n\n.directive 'sparkId', (sparkId)->\n  (scope, element, attr) ->\n    sparkId.registerElement(attr.sparkId, element)\n    scope.$on '$destroy', -> delete sparkId.elements[attr.sparkId]\n\ndirectiveFn = ($window, $timeout, sparkFormulas, sparkActionProps, sparkAnimator, sparkId, sparkSetup) ->\n  (scope, element, attr) ->\n\n    hasAnimateAttr = attr.hasOwnProperty('sparkScrollAnimate')  # when using spark-scroll-animate directive animation is enabled\n    isAnimated = hasAnimateAttr\n\n    animator = hasAnimateAttr && sparkAnimator.instance()\n    actor = isAnimated && animator.addActor({ context: element[0] })\n    y = 0\n    prevy = 0\n    scrollY = 0\n    animationFrame = AnimationFrame && new AnimationFrame()\n    updating = false\n\n    data = null\n    sparkData = null\n    actionFrames = []\n    actionFrameIdx = -1\n    container = document.documentElement\n\n    triggerElement = element\n\n    if attr.sparkTrigger\n      setTriggerElement = ->\n        if sparkId.elements[attr.sparkTrigger]\n          triggerElement = sparkId.elements[attr.sparkTrigger]\n          recalcFormulas() if recalcFormulas\n        else\n          # aggressively poll for the trigger element if we don't find it (because it's not ready yet)\n          $timeout setTriggerElement, 0, false\n      setTriggerElement()\n\n    actionsUpdate = ->\n\n      d = y - prevy\n\n      if d<0 and actionFrameIdx >= 0  # scroll up: don't apply on page load (only apply on page load for downward movement)\n        idx = if (actionFrameIdx >= actionFrames.length) then actionFrameIdx-1 else actionFrameIdx\n        while (idx >= 0 and y < actionFrames[idx])\n          c = sparkData[actionFrames[idx]]\n\n          for a, o of c.actions\n            for prop in o.props\n              actionProp = sparkActionProps[prop]\n              actionProp.up.call(c, o) if actionProp.up\n\n          actionFrameIdx = --idx\n\n      if d>=0 and actionFrameIdx < actionFrames.length  # scroll down: will apply on page load\n        idx = if (actionFrameIdx < 0) then 0 else actionFrameIdx\n        while (idx < actionFrames.length and y > actionFrames[idx])\n          c = sparkData[actionFrames[idx]]\n\n          for a, o of c.actions\n            for prop in o.props\n              actionProp = sparkActionProps[prop]\n              actionProp.down.call(c, o) if actionProp.down\n\n          actionFrameIdx = ++idx\n\n      prevy = y\n      updating = false\n\n\n    # update for spark-scroll-animate (sparkAnimator-based) animation\n    if attr.hasOwnProperty('sparkScrollEase')\n      update = ->\n        d = scrollY - y\n        ad = Math.abs(d)\n        actionsUpdate() # sets updating = false\n        if ad < 1.5\n          y = scrollY\n          animator.update(y)\n        else\n          updating = true\n          y += if ad>8 then d*0.25 else (if d > 0 then 1 else -1) # ease the scroll\n          animator.update(parseInt(y))\n          animationFrame.request(update)\n    else\n      update = ->\n        y = scrollY\n        animator.update(y)\n        actionsUpdate() # sets updating = false\n\n\n    recalcFormulas = ->\n      if sparkData\n        changed = false\n        rect = triggerElement[0].getBoundingClientRect()\n        containerRect = container.getBoundingClientRect()\n\n        for scrY, keyFrame of sparkData when keyFrame.formula\n          newScrY = keyFrame.formula.fn(triggerElement, container, rect, containerRect, keyFrame.formula.offset)\n          if newScrY != ~~scrY\n            changed = true\n            actor.moveKeyframe(~~scrY, newScrY) if keyFrame.anims and hasAnimateAttr # the ~~ is necessary :(\n            sparkData[newScrY] = keyFrame\n            delete sparkData[scrY]\n\n        if changed\n          actionFrames = []\n          actionFrames.push(~~scrY) for scrY, kf of sparkData when kf.actionCount\n          actionFrames.sort (a,b) -> a > b\n          onScroll()  # todo: this is checking scrollY unnecessarily\n          # @todo: now are we screwed if something was already passed by ?\n      else\n        parseData()\n        recalcFormulas() if sparkData\n\n\n    parseData = ->\n      return unless data\n\n      actor.removeAllKeyframes() if hasAnimateAttr\n\n      # element ease property\n      elmEase = data.ease || 'linear';\n      delete data.ease\n      animCount = 0\n\n      sparkData = {}\n      actionFrames = []\n\n      # this is used for formula comprehension... a possible performance improvement might\n      # forgo these calculations by adding some option or deferring calculation automatically\n      rect = triggerElement[0].getBoundingClientRect()\n      containerRect = container.getBoundingClientRect()\n\n      for scrY, keyFrame of data\n        keyFrame = _.clone(keyFrame)  # clone for cases when parseData fails and needs to be called again\n        actionCount = 0\n\n        # formula comprehension\n        # when scrollY first char is not a digit, we assume this is a formula\n        c = scrY.charCodeAt(0)\n        if (c < 48 or c > 57)\n          parts = scrY.match(/^(\\w+)(.*)$/)\n          formula =\n            fn: sparkFormulas[parts[1]],\n            offset: ~~parts[2]\n\n          scrY = formula.fn(triggerElement, container, rect, containerRect, formula.offset)\n          if sparkData[scrY]  # silent death for overlapping scrY's (assume that the element isn't ready)\n            console.log \"warning: spark-scroll failed to parse data\", (attr.sparkScroll || attr.sparkScrollAnimate) if sparkSetup.debug\n            sparkData = null\n            return\n\n        # keyframe ease property\n        # (will override or fallback to element ease property)\n        ease = {}\n        kfEase = elmEase\n        if keyFrame.ease?\n          if angular.isObject(keyFrame.ease)\n            ease = keyFrame.ease\n          else\n            kfEase = keyFrame.ease\n          delete keyFrame.ease\n\n        for k,v of keyFrame\n          ksplit = k.split(',')\n\n          # put actions in actions sub-object\n          if sparkActionProps[ksplit[0]] # @todo: rigorous check ? (we assume that if the first action is legit then they all are)\n\n            keyFrame.actions or= { }  # could be more efficient to make actions an array\n            keyFrame.actions[k] = # action object\n              props: ksplit\n              val: v\n            delete keyFrame[k]\n            actionCount++\n\n            # put animations in anims sub-object\n          else # since it's not an action, assume it's an animation property\n\n            # comprehension of array-notation for easing\n            # (will override or fall back to keyframe ease propery as needed)\n            keyFrame.anims or= {}\n            v = [v, kfEase] unless angular.isArray(v)\n            o = {}\n            o[k] = v[1]\n            angular.extend(ease, o)\n\n            keyFrame.anims[k] = v[0]\n            delete keyFrame[k]\n\n        if keyFrame.anims && hasAnimateAttr\n          actor.keyframe(scrY, keyFrame.anims, ease)\n          animCount++\n\n        keyFrame.formula = formula\n        keyFrame.element = element\n        keyFrame.scope = scope\n        keyFrame.actionCount = actionCount\n\n        sparkData[scrY] = keyFrame\n        actionFrames.push(~~scrY) if actionCount\n\n      isAnimated = hasAnimateAttr && !! animCount\n\n      # actors can optionally expose this function to receive a notification that parsing completed\n      actor.finishedAddingKeyframes && actor.finishedAddingKeyframes() if isAnimated\n\n      actionFrames.sort (a,b) -> a > b\n\n      y = prevy = scrollY = $window.scrollY\n      update() if isAnimated\n      actionsUpdate()\n\n    watchCancel = scope.$watch attr[if hasAnimateAttr then 'sparkScrollAnimate' else 'sparkScroll'], (d) ->\n      return unless d\n      data = _.clone(d)   # clone for cases when parseData fails and needs to be called again\n\n      # useful in angular < v1.3 where one-time binding isn't available\n      if attr.sparkScrollBindOnce? then watchCancel()\n\n      parseData()\n    , true  # deep watch\n\n    # respond to scroll event\n\n    onScroll = ->\n      scrollY = $window.scrollY\n\n      unless updating # debounced update\n        updating = true # in-case multiple scroll events can occur in one frame (possible?)\n        if isAnimated\n            animationFrame.request(update)\n        else\n          y = scrollY\n          animationFrame.request(actionsUpdate) # @todo: do these calls get queued between frames ?\n\n    onInvalidate = _.debounce(recalcFormulas, 100, {leading: false})\n\n    angular.element($window).on 'scroll', onScroll\n    angular.element($window).on 'resize', onInvalidate\n    scope.$on 'sparkInvalidate', onInvalidate\n\n    scope.$on '$destroy', ->\n      animator.removeActor(actor) if isAnimated\n      angular.element($window).off 'scroll', onScroll\n      angular.element($window).off 'resize', onInvalidate\n\n\nangular.module('gilbox.sparkScroll')\n  .directive 'sparkScroll',        ['$window', '$timeout', 'sparkFormulas', 'sparkActionProps', 'sparkAnimator', 'sparkId', 'sparkSetup', directiveFn]\n  .directive 'sparkScrollAnimate', ['$window', '$timeout', 'sparkFormulas', 'sparkActionProps', 'sparkAnimator', 'sparkId', 'sparkSetup', directiveFn]\n"]}
{"version":3,"sources":["kapi-scroll.coffee"],"names":[],"mappings":"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","file":"kapi-scroll.js","sourceRoot":"/source/","sourcesContent":["  angular.module('gilbox.kapiScroll', [])\n    .factory 'rekapi', ($document) -> new Rekapi($document[0].body)\n    .directive 'kapiScroll', (rekapi, $window) ->\n      (scope, element, attr) ->\n        actor = rekapi.addActor({ context: element[0] })\n        y = 0\n        lastScrollY = 0\n        scrollY = 0\n        animationFrame = new AnimationFrame()\n        updating = false\n\n        classes = {}\n        classFrames = []\n        classFrameIdx = -1\n\n        classesUpdate = (d) ->\n\n          if d<0 and classFrameIdx >= 0  # only apply on page load for downward movement\n            idx = if (classFrameIdx >= classFrames.length) then classFrameIdx-1 else classFrameIdx\n            while (idx >= 0 and y < classFrames[idx])\n              c = classes[classFrames[idx]]\n\n              element.removeClass(c.class) if c.class\n              element.addClass(c.classUp) if c.classUp\n              element.removeClass(c.classUpRemove) if c.classUpRemove\n\n              classFrameIdx = --idx\n\n          if d>=0 and classFrameIdx < classFrames.length\n            idx = if (classFrameIdx < 0) then 0 else classFrameIdx\n            while (idx < classFrames.length and y > classFrames[idx])\n              c = classes[classFrames[idx]]\n\n              element.addClass(c.class) if c.class\n              element.removeClass(c.classUp) if c.classUp\n              element.removeClass(c.classRemove) if c.classRemove\n\n              classFrameIdx = ++idx\n\n\n        update = ->\n          d = scrollY - y\n          ad = Math.abs(d)\n          if ad < 1.5\n            updating = false\n            y = scrollY\n            rekapi.update(y)\n          else\n            updating = true\n            y += if ad>8 then d*0.25 else (if d > 0 then 1 else -1) # ease the scroll\n            rekapi.update(parseInt(y))\n            animationFrame.request(update)\n\n          classesUpdate(d)  # todo: is there a better place for this? debounce this more ?\n\n\n        scope.$watch attr.kapiScroll, (data) ->\n          return unless data\n\n          # element ease property\n          elmEase = data.ease || 'linear';\n          delete data.ease\n\n          classes = {}\n          classFrames = []\n\n          # setup the rekapi keyframes\n          for scrollY, keyFrame of data\n\n            classFrames.push(parseInt(scrollY)) if keyFrame.class? || keyFrame.classUp? || keyFrame.classRemove? || keyFrame.classUpRemove?\n\n            # keyframe class property\n            # added when scrolled down past keyframe\n            # removed when scrolled up past keyframe\n            # this is not handled by rekapi, so we pull it out and tcb\n            if keyFrame.class?\n              classes[scrollY] or= {}\n              angular.extend(classes[scrollY], {class: keyFrame.class})\n              delete keyFrame.class\n\n            # keyframe classUp property\n            # added when scrolled up past keyframe\n            # removed when scrolled down past keyframe\n            # this is not handled by rekapi, so we pull it out and tcb\n            if keyFrame.classUp?\n              classes[scrollY] or= {}\n              angular.extend(classes[scrollY], {classUp: keyFrame.classUp})\n              delete keyFrame.classUp\n\n            # keyframe classUp property\n            # removed when scrolled down past keyframe\n            # this is not handled by rekapi, so we pull it out and tcb\n            if keyFrame.classRemove?\n              classes[scrollY] or= {}\n              angular.extend(classes[scrollY], {classRemove: keyFrame.classRemove})\n              delete keyFrame.classRemove\n\n            # keyframe classUp property\n            # removed when scrolled up past keyframe\n            # this is not handled by rekapi, so we pull it out and tcb\n            if keyFrame.classUpRemove?\n              classes[scrollY] or= {}\n              angular.extend(classes[scrollY], {classUpRemove: keyFrame.classUpRemove})\n              delete keyFrame.classUpRemove\n\n\n            # keyframe ease property\n            # (will override or fallback to element ease property)\n            ease = {}\n            kfEase = elmEase\n            if keyFrame.ease?\n              if angular.isObject(keyFrame.ease)\n                ease = keyFrame.ease\n              else\n                kfEase = keyFrame.ease\n              delete keyFrame.ease\n\n            # comprehension of array-notation for easing\n            # (will override or fall back to keyframe ease propery as needed)\n            for prop, val of keyFrame\n              val = [val, kfEase] if not angular.isArray(val)\n              o = {}\n              o[prop] = val[1]\n              angular.extend(ease, o)\n              keyFrame[prop] = val[0]\n\n            actor.keyframe(scrollY, keyFrame, ease)\n\n          classFrames.sort (a,b) -> a > b\n\n          y = scrollY = $window.scrollY\n          update()\n        , true  # deep watch\n\n        # respond to scroll event\n        angular.element($window).on 'scroll', ->\n          lastScrollY = scrollY\n          scrollY = $window.scrollY\n          update() if !updating # debounced update\n\n        scope.$on '$destroy', -> rekapi.removeActor(actor)"]}
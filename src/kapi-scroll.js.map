{"version":3,"sources":["kapi-scroll.coffee"],"names":[],"mappings":"AAAE;AAAA,EAAA,OAAO,CAAC,MAAR,CAAe,mBAAf,EAAoC,EAApC,CACE,CAAC,OADH,CACW,QADX,EACqB,SAAC,SAAD,GAAA;WAAmB,IAAA,MAAA,CAAO,SAAU,CAAA,CAAA,CAAE,CAAC,IAApB,EAAnB;EAAA,CADrB,CAEE,CAAC,SAFH,CAEa,YAFb,EAE2B,SAAC,MAAD,EAAS,OAAT,GAAA;WACvB,SAAC,KAAD,EAAQ,OAAR,EAAiB,IAAjB,GAAA;AACE,UAAA,iJAAA;AAAA,MAAA,KAAA,GAAQ,MAAM,CAAC,QAAP,CAAgB;AAAA,QAAE,OAAA,EAAS,OAAQ,CAAA,CAAA,CAAnB;OAAhB,CAAR,CAAA;AAAA,MACA,CAAA,GAAI,CADJ,CAAA;AAAA,MAEA,OAAA,GAAU,CAFV,CAAA;AAAA,MAGA,cAAA,GAAqB,IAAA,cAAA,CAAA,CAHrB,CAAA;AAAA,MAIA,QAAA,GAAW,KAJX,CAAA;AAAA,MAMA,WAAA,GAAc,CAIZ,MAJY,EAQZ,QARY,EAaZ,OAbY,EAkBZ,SAlBY,EAsBZ,aAtBY,EA0BZ,eA1BY,CANd,CAAA;AAAA,MAkCA,OAAA,GAAU,EAlCV,CAAA;AAAA,MAmCA,YAAA,GAAe,EAnCf,CAAA;AAAA,MAoCA,cAAA,GAAiB,CAAA,CApCjB,CAAA;AAAA,MAsCA,aAAA,GAAgB,SAAA,GAAA;AAEd,YAAA,mBAAA;AAAA,QAAA,CAAA,GAAI,OAAA,GAAU,CAAd,CAAA;AAEA,QAAA,IAAG,CAAA,GAAE,CAAF,IAAQ,cAAA,IAAkB,CAA7B;AACE,UAAA,GAAA,GAAU,cAAA,IAAkB,YAAY,CAAC,MAAnC,GAAgD,cAAA,GAAe,CAA/D,GAAsE,cAA5E,CAAA;AACA,iBAAO,GAAA,IAAO,CAAP,IAAa,CAAA,GAAI,YAAa,CAAA,GAAA,CAArC,GAAA;AACE,YAAA,CAAA,GAAI,OAAQ,CAAA,YAAa,CAAA,GAAA,CAAb,CAAZ,CAAA;AAEA,YAAA,IAAgC,CAAC,CAAC,OAAD,CAAjC;AAAA,cAAA,OAAO,CAAC,WAAR,CAAoB,CAAC,CAAC,OAAD,CAArB,CAAA,CAAA;aAFA;AAGA,YAAA,IAA+B,CAAC,CAAC,OAAjC;AAAA,cAAA,OAAO,CAAC,QAAR,CAAiB,CAAC,CAAC,OAAnB,CAAA,CAAA;aAHA;AAIA,YAAA,IAAwC,CAAC,CAAC,aAA1C;AAAA,cAAA,OAAO,CAAC,WAAR,CAAoB,CAAC,CAAC,aAAtB,CAAA,CAAA;aAJA;AAKA,YAAA,IAAY,CAAC,CAAC,IAAd;AAAA,cAAA,CAAC,CAAC,IAAF,CAAA,CAAA,CAAA;aALA;AAAA,YAOA,cAAA,GAAiB,EAAA,GAPjB,CADF;UAAA,CAFF;SAFA;AAcA,QAAA,IAAG,CAAA,IAAG,CAAH,IAAS,cAAA,GAAiB,YAAY,CAAC,MAA1C;AACE,UAAA,GAAA,GAAU,cAAA,GAAiB,CAArB,GAA6B,CAA7B,GAAoC,cAA1C,CAAA;AACA;iBAAO,GAAA,GAAM,YAAY,CAAC,MAAnB,IAA8B,CAAA,GAAI,YAAa,CAAA,GAAA,CAAtD,GAAA;AACE,YAAA,CAAA,GAAI,OAAQ,CAAA,YAAa,CAAA,GAAA,CAAb,CAAZ,CAAA;AAEA,YAAA,IAA6B,CAAC,CAAC,OAAD,CAA9B;AAAA,cAAA,OAAO,CAAC,QAAR,CAAiB,CAAC,CAAC,OAAD,CAAlB,CAAA,CAAA;aAFA;AAGA,YAAA,IAAkC,CAAC,CAAC,OAApC;AAAA,cAAA,OAAO,CAAC,WAAR,CAAoB,CAAC,CAAC,OAAtB,CAAA,CAAA;aAHA;AAIA,YAAA,IAAsC,CAAC,CAAC,WAAxC;AAAA,cAAA,OAAO,CAAC,WAAR,CAAoB,CAAC,CAAC,WAAtB,CAAA,CAAA;aAJA;AAKA,YAAA,IAAc,CAAC,CAAC,MAAhB;AAAA,cAAA,CAAC,CAAC,MAAF,CAAA,CAAA,CAAA;aALA;AAAA,0BAOA,cAAA,GAAiB,EAAA,IAPjB,CADF;UAAA,CAAA;0BAFF;SAhBc;MAAA,CAtChB,CAAA;AAAA,MAmEA,aAAA,GAAgB,CAAC,CAAC,QAAF,CAAW,aAAX,EAA0B,EAA1B,EAA8B;AAAA,QAAC,OAAA,EAAS,IAAV;AAAA,QAAgB,OAAA,EAAS,EAAzB;OAA9B,CAnEhB,CAAA;AAAA,MAsEA,MAAA,GAAS,SAAA,GAAA;AACP,YAAA,KAAA;AAAA,QAAA,CAAA,GAAI,OAAA,GAAU,CAAd,CAAA;AAAA,QACA,EAAA,GAAK,IAAI,CAAC,GAAL,CAAS,CAAT,CADL,CAAA;AAEA,QAAA,IAAG,EAAA,GAAK,GAAR;AACE,UAAA,QAAA,GAAW,KAAX,CAAA;AAAA,UACA,CAAA,GAAI,OADJ,CAAA;iBAEA,MAAM,CAAC,MAAP,CAAc,CAAd,EAHF;SAAA,MAAA;AAKE,UAAA,QAAA,GAAW,IAAX,CAAA;AAAA,UACA,CAAA,IAAQ,EAAA,GAAG,CAAN,GAAa,CAAA,GAAE,IAAf,GAAyB,CAAI,CAAA,GAAI,CAAP,GAAc,CAAd,GAAqB,CAAA,CAAtB,CAD9B,CAAA;AAAA,UAEA,MAAM,CAAC,MAAP,CAAc,QAAA,CAAS,CAAT,CAAd,CAFA,CAAA;iBAGA,cAAc,CAAC,OAAf,CAAuB,MAAvB,EARF;SAHO;MAAA,CAtET,CAAA;AAAA,MAqFA,UAAA,GAAa,SAAC,GAAD,GAAA;eACX,GAAG,CAAC,OAAJ,CAAY,MAAZ,EAAoB,GAApB,CAAwB,CAAC,OAAzB,CAAiC,mBAAjC,EAAsD,OAAtD,EADW;MAAA,CArFb,CAAA;AAAA,MAyFA,aAAA,GAAgB,KAAK,CAAC,MAAN,CAAa,IAAI,CAAC,UAAlB,EAA8B,SAAC,IAAD,GAAA;AAC5C,YAAA,mEAAA;AAAA,QAAA,IAAA,CAAA,IAAA;AAAA,gBAAA,CAAA;SAAA;AAGA,QAAA,IAAG,+BAAH;AAAiC,UAAA,aAAA,CAAA,CAAA,CAAjC;SAHA;AAAA,QAMA,OAAA,GAAU,IAAI,CAAC,IAAL,IAAa,QANvB,CAAA;AAAA,QAOA,MAAA,CAAA,IAAW,CAAC,IAPZ,CAAA;AAAA,QASA,OAAA,GAAU,EATV,CAAA;AAAA,QAUA,YAAA,GAAe,EAVf,CAAA;AAaA,aAAA,eAAA;mCAAA;AAEE,UAAA,IAAwC,QAAQ,CAAC,OAAD,CAAR,IAAkB,QAAQ,CAAC,OAA3B,IAAsC,QAAQ,CAAC,WAA/C,IAA8D,QAAQ,CAAC,aAAvE,IAAwF,QAAQ,CAAC,IAAjG,IAAyG,QAAQ,CAAC,MAA1J;AAAA,YAAA,YAAY,CAAC,IAAb,CAAkB,QAAA,CAAS,OAAT,CAAlB,CAAA,CAAA;WAAA;AAGA,eAAA,kDAAA;yCAAA;AACE,YAAA,IAAG,QAAS,CAAA,UAAA,CAAZ;AACE,cAAA,OAAQ,CAAA,OAAA,MAAR,OAAQ,CAAA,OAAA,IAAa,GAArB,CAAA;AAAA,cACA,OAAQ,CAAA,OAAA,CAAS,CAAA,UAAA,CAAjB,GAA+B,QAAS,CAAA,UAAA,CADxC,CAAA;AAAA,cAEA,MAAA,CAAA,QAAgB,CAAA,UAAA,CAFhB,CADF;aADF;AAAA,WAHA;AAAA,UAWA,IAAA,GAAO,EAXP,CAAA;AAAA,UAYA,MAAA,GAAS,OAZT,CAAA;AAaA,UAAA,IAAG,qBAAH;AACE,YAAA,IAAG,OAAO,CAAC,QAAR,CAAiB,QAAQ,CAAC,IAA1B,CAAH;AACE,cAAA,IAAA,GAAO,QAAQ,CAAC,IAAhB,CADF;aAAA,MAAA;AAGE,cAAA,MAAA,GAAS,QAAQ,CAAC,IAAlB,CAHF;aAAA;AAAA,YAIA,MAAA,CAAA,QAAe,CAAC,IAJhB,CADF;WAbA;AAsBA,eAAA,gBAAA;iCAAA;AACE,YAAA,IAAA,GAAO,UAAA,CAAW,IAAX,CAAP,CAAA;AACA,YAAA,IAAuB,CAAA,OAAW,CAAC,OAAR,CAAgB,GAAhB,CAA3B;AAAA,cAAA,GAAA,GAAM,CAAC,GAAD,EAAM,MAAN,CAAN,CAAA;aADA;AAAA,YAEA,CAAA,GAAI,EAFJ,CAAA;AAAA,YAGA,CAAE,CAAA,IAAA,CAAF,GAAU,GAAI,CAAA,CAAA,CAHd,CAAA;AAAA,YAIA,OAAO,CAAC,MAAR,CAAe,IAAf,EAAqB,CAArB,CAJA,CAAA;AAAA,YAKA,QAAS,CAAA,IAAA,CAAT,GAAiB,GAAI,CAAA,CAAA,CALrB,CADF;AAAA,WAtBA;AAAA,UA8BA,KAAK,CAAC,QAAN,CAAe,OAAf,EAAwB,QAAxB,EAAkC,IAAlC,CA9BA,CAFF;AAAA,SAbA;AAAA,QA+CA,YAAY,CAAC,IAAb,CAAkB,SAAC,CAAD,EAAG,CAAH,GAAA;iBAAS,CAAA,GAAI,EAAb;QAAA,CAAlB,CA/CA,CAAA;AAAA,QAiDA,CAAA,GAAI,OAAA,GAAU,OAAO,CAAC,OAjDtB,CAAA;AAAA,QAkDA,MAAA,CAAA,CAlDA,CAAA;eAmDA,aAAA,CAAA,EApD4C;MAAA,CAA9B,EAqDd,IArDc,CAzFhB,CAAA;AAAA,MAiJA,OAAO,CAAC,OAAR,CAAgB,OAAhB,CAAwB,CAAC,EAAzB,CAA4B,QAA5B,EAAsC,SAAA,GAAA;AACpC,QAAA,OAAA,GAAU,OAAO,CAAC,OAAlB,CAAA;AAAA,QACA,aAAA,CAAA,CADA,CAAA;AAEA,QAAA,IAAY,CAAA,QAAZ;iBAAA,MAAA,CAAA,EAAA;SAHoC;MAAA,CAAtC,CAjJA,CAAA;aAsJA,KAAK,CAAC,GAAN,CAAU,UAAV,EAAsB,SAAA,GAAA;AACpB,QAAA,MAAM,CAAC,WAAP,CAAmB,KAAnB,CAAA,CAAA;eACA,OAAO,CAAC,OAAR,CAAgB,OAAhB,CAAwB,CAAC,GAAzB,CAA6B,QAA7B,EAFoB;MAAA,CAAtB,EAvJF;IAAA,EADuB;EAAA,CAF3B,CAAA,CAAA;AAAA","file":"kapi-scroll.js","sourceRoot":"/source/","sourcesContent":["  angular.module('gilbox.kapiScroll', [])\n    .factory 'rekapi', ($document) -> new Rekapi($document[0].body)\n    .directive 'kapiScroll', (rekapi, $window) ->\n      (scope, element, attr) ->\n        actor = rekapi.addActor({ context: element[0] })\n        y = 0\n        scrollY = 0\n        animationFrame = new AnimationFrame()\n        updating = false\n\n        actionProps = [\n\n          # keyframe onUp property\n          # fn reference that is called when scrolled up past keyframe\n          'onUp'\n\n          # keyframe onDown property\n          # fn reference that is called when scrolled down past keyframe\n          'onDown'\n\n          # keyframe class property\n          # class(es) added when scrolled down past keyframe,\n          # but removed when scrolled up past keyframe\n          'class'\n\n          # keyframe classUp property\n          # class(es) added when scrolled up past keyframe,\n          # but removed when scrolled down past keyframe\n          'classUp'\n\n          # keyframe classRemove property\n          # class(es) removed when scrolled down past keyframe\n          'classRemove'\n\n          # keyframe classUpRemove property\n          # class(es) removed when scrolled up past keyframe\n          'classUpRemove'\n        ]\n        actions = {}\n        actionFrames = []\n        actionFrameIdx = -1\n\n        actionsUpdate = ->\n\n          d = scrollY - y\n\n          if d<0 and actionFrameIdx >= 0  # only apply on page load for downward movement\n            idx = if (actionFrameIdx >= actionFrames.length) then actionFrameIdx-1 else actionFrameIdx\n            while (idx >= 0 and y < actionFrames[idx])\n              c = actions[actionFrames[idx]]\n\n              element.removeClass(c.class) if c.class\n              element.addClass(c.classUp) if c.classUp\n              element.removeClass(c.classUpRemove) if c.classUpRemove\n              c.onUp() if c.onUp\n\n              actionFrameIdx = --idx\n\n          if d>=0 and actionFrameIdx < actionFrames.length\n            idx = if (actionFrameIdx < 0) then 0 else actionFrameIdx\n            while (idx < actionFrames.length and y > actionFrames[idx])\n              c = actions[actionFrames[idx]]\n\n              element.addClass(c.class) if c.class\n              element.removeClass(c.classUp) if c.classUp\n              element.removeClass(c.classRemove) if c.classRemove\n              c.onDown() if c.onDown\n\n              actionFrameIdx = ++idx\n\n\n        actionsUpdate = _.debounce(actionsUpdate, 33, {leading: true, maxWait: 33})\n\n\n        update = ->\n          d = scrollY - y\n          ad = Math.abs(d)\n          if ad < 1.5\n            updating = false\n            y = scrollY\n            rekapi.update(y)\n          else\n            updating = true\n            y += if ad>8 then d*0.25 else (if d > 0 then 1 else -1) # ease the scroll\n            rekapi.update(parseInt(y))\n            animationFrame.request(update)\n\n\n        # automatic conversion from camelCase to dashed-case\n        dashersize = (str) ->\n          str.replace(/\\W+/g, '-').replace(/([a-z\\d])([A-Z])/g, '$1-$2')\n\n\n        ksWatchCancel = scope.$watch attr.kapiScroll, (data) ->\n          return unless data\n\n          # useful in angular < v1.3 where one-time binding isn't available\n          if attr.kapiScrollBindOnce? then ksWatchCancel()\n\n          # element ease property\n          elmEase = data.ease || 'linear';\n          delete data.ease\n\n          actions = {}\n          actionFrames = []\n\n          # setup the rekapi keyframes\n          for scrollY, keyFrame of data\n\n            actionFrames.push(parseInt(scrollY)) if keyFrame.class || keyFrame.classUp || keyFrame.classRemove || keyFrame.classUpRemove || keyFrame.onUp || keyFrame.onDown\n\n            # custom actions not supported by rekapi\n            for actionProp in actionProps\n              if keyFrame[actionProp]\n                actions[scrollY] or= {}\n                actions[scrollY][actionProp] = keyFrame[actionProp]\n                delete keyFrame[actionProp]\n\n            # keyframe ease property\n            # (will override or fallback to element ease property)\n            ease = {}\n            kfEase = elmEase\n            if keyFrame.ease?\n              if angular.isObject(keyFrame.ease)\n                ease = keyFrame.ease\n              else\n                kfEase = keyFrame.ease\n              delete keyFrame.ease\n\n            # comprehension of array-notation for easing\n            # (will override or fall back to keyframe ease propery as needed)\n            for prop, val of keyFrame\n              prop = dashersize(prop)\n              val = [val, kfEase] if not angular.isArray(val)\n              o = {}\n              o[prop] = val[1]\n              angular.extend(ease, o)\n              keyFrame[prop] = val[0]\n\n            actor.keyframe(scrollY, keyFrame, ease)\n\n          actionFrames.sort (a,b) -> a > b\n\n          y = scrollY = $window.scrollY\n          update()\n          actionsUpdate()\n        , true  # deep watch\n\n        # respond to scroll event\n        angular.element($window).on 'scroll', ->\n          scrollY = $window.scrollY\n          actionsUpdate()\n          update() if !updating # debounced update\n\n        scope.$on '$destroy', ->\n          rekapi.removeActor(actor)\n          angular.element($window).off 'scroll'"]}